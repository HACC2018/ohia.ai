library(data.table)
library(stringr)
setwd('../')
setwd('../')
dir('dadta')
dir('data')
plant_meta <- fread('data/plant_categories_v3.csv')
plant_meta
plant_meta <- fread('data/plant_categories_v3.csv', select='plant_name')
plant_meta
library(data.table)
clean_text <- function( x){
x <- gsub('\n', ' ', x)         # replace new lines with space
x <- gsub('\\[\\d+\\]', '', x)  # remove references [\\d+]
x <- gsub('\\"+', '\\"', x)     # remove double quotes
x <- gsub('\\s+', ' ', x)       # remove extra whitespace
x <- trimws(x)                  # remove leading and trailing ws
x
}
DT <- fread('data/plant_categories_v2.csv')
plant_meta <- fread('data/plant_categories_v3.csv', select='genus')
plant_meta
plant_meta[, .N, by=genus]
plant_meta <- fread('data/plant_categories_v3.csv', select='genus')
plant_meta[, .N, by=genus]
plant_meta[, .N, by=genus][N>1]
plant_meta <- fread('data/plant_categories_v3.csv')
plant_meta[, .(.N, species=lis(species)), by=genus][N>1]
plant_meta[, .(.N, species=list(species)), by=genus][N>1]
plant_meta[, .(species_count=.N, species=list(species)), by=genus][N>1]
plant_meta
plant_meta <- fread('data/plant_categories_v3.csv')
plant_meta[, .(species_count=.N, species=list(species)), by=genus][N>1]
plant_meta[, .(species_count=.N, species=list(species)), by=genus][species_count>1]
plant_meta[, .(.N, species=list(species)), by=genus][N>1, -'N']
plant_meta[, .(.N, species=paste(species, sep='\n')), by=genus][N>1, -'N']
names(plant_meta)
plant_meta[, .(.N, species), by=genus][N>1, species]
library(data.table)
clean_text <- function( x){
x <- gsub('\n', ' ', x)         # replace new lines with space
x <- gsub('\\[\\d+\\]', '', x)  # remove references [\\d+]
x <- gsub('\\"+', '\\"', x)     # remove double quotes
x <- gsub('\\s+', ' ', x)       # remove extra whitespace
x <- trimws(x)                  # remove leading and trailing ws
x
}
DT <- fread('data/plant_categories_v2.csv')
DT[, description := clean_text(description)]
DT[, story := clean_text(story)]
DT[, uses := clean_text(uses)]
# combine genera with multiple species:
# genus               species
# 1: Tibouchina   Tibouchina herbacea
# 2: Tibouchina Tibouchina urvilleana
# 3:    Panicum       Panicum fauriei
# 4:    Panicum    Panicum niihauense
# 5:  Portulaca Portulaca sclerocarpa
# 6:  Portulaca     Portulaca villosa
# combine genera with multiple species:
DT[, .(.N, species), by=genus][N>1, species]
# combine genera with multiple species:
DT[, .(.N, species), by=genus][N>1, -'N']
# combine genera with multiple species:
print(DT[, .(.N, species), by=genus][N>1, -'N'])
DT[species == 'Tibouchina herbacea']
DT[species == 'Tibouchina urvilleana']
DT[species == 'Tibouchina herbacea']
DT[species == 'Tibouchina herbacea']
DT[species == 'Tibouchina urvilleana']
# reassign plant_name
DT[, .(.N, species), by=genus][N>1, -'N']
# reassign plant_name
species_count <- DT[, .N, by=genus]
species_count
# reassign plant_name
species_count <- DT[, .N, by=genus]$N
DT
library(data.table)
clean_text <- function( x){
x <- gsub('\n', ' ', x)         # replace new lines with space
x <- gsub('\\[\\d+\\]', '', x)  # remove references [\\d+]
x <- gsub('\\"+', '\\"', x)     # remove double quotes
x <- gsub('\\s+', ' ', x)       # remove extra whitespace
x <- trimws(x)                  # remove leading and trailing ws
x
}
DT <- fread('data/plant_categories_v2.csv')
DT[, description := clean_text(description)]
DT[, story := clean_text(story)]
DT[, uses := clean_text(uses)]
# reassign plant_name
DT[, species_count := .N, keyby=genus]
DT
DT[, plant_name = ifelse(species_count==1, genus, species)]
library(data.table)
clean_text <- function( x){
x <- gsub('\n', ' ', x)         # replace new lines with space
x <- gsub('\\[\\d+\\]', '', x)  # remove references [\\d+]
x <- gsub('\\"+', '\\"', x)     # remove double quotes
x <- gsub('\\s+', ' ', x)       # remove extra whitespace
x <- trimws(x)                  # remove leading and trailing ws
x
}
DT <- fread('data/plant_categories_v2.csv')
DT[, description := clean_text(description)]
DT[, story := clean_text(story)]
DT[, uses := clean_text(uses)]
# reassign plant_name
DT[, species_count := .N, keyby=genus]
DT[, plant_name := ifelse(species_count==1, genus, species)]
DT
DT
DT[['plant_name']]
DT[, plant_name := sapply(plant_name, function(x) {
first_letter <- toupper(substr(x,1,1))
remainder <- substr(x,2,nchar(x))
paste0(first_letter, remainder)
})]
DT$plant_name
?substring
library(data.table)
# load data
DT <- fread('data/plant_categories_v2.csv')
# clean text
clean_text <- function( x){
x <- gsub('\n', ' ', x)         # replace new lines with space
x <- gsub('\\[\\d+\\]', '', x)  # remove references [\\d+]
x <- gsub('\\"+', '\\"', x)     # remove double quotes
x <- gsub('\\s+', ' ', x)       # remove extra whitespace
x <- trimws(x)                  # remove leading and trailing ws
x
}
DT[, description := clean_text(description)]
DT[, story := clean_text(story)]
DT[, uses := clean_text(uses)]
# capatilize all words
capatilize_all <- function(x) {
s <- strsplit(x, " ")[[1]]
paste(toupper(substring(s, 1,1)), substring(s, 2), sep="", collapse=" ")
}
DT[, hawaiian_name := sapply(hawaiian_name, capatilize_all)]
DT[, common_name := sapply(common_name, capatilize_all)]
# capatilize first word
capatilize_first <- function(x) {
paste0(toupper(substr(x,1,1)), substr(x,2))
}
DT[, scientific_name := sapply(scientific_name, capatilize_first)]
DT[, species := sapply(species, capatilize_first)]
DT[, genus := sapply(genus, capatilize_first)]
# reassign plant_name
DT[, species_count := .N, keyby=genus]
DT[, plant_name := ifelse(species_count==1, genus, species)]
# capatilize first word
capatilize_first <- function(x) {
paste0(toupper(substr(x,1,1)), substring(x,2))
}
DT[, scientific_name := sapply(scientific_name, capatilize_first)]
DT[, species := sapply(species, capatilize_first)]
DT[, genus := sapply(genus, capatilize_first)]
# reassign plant_name
DT[, species_count := .N, keyby=genus]
DT[, plant_name := ifelse(species_count==1, genus, species)]
DT[, -c('description', 'story', 'uses')]
names(DT[, -c('description', 'story', 'uses')])
# reassign plant_name: hawaiian > common > genus > species
DT[, plant_name := hawaiian_name]
DT
DT[, .(plant_name)]
DT[, .(plant_name=='')]
DT[, .(plant_name)]
DT[plant_name=='', plant_name := common_name]
DT[, .(plant_name)]
DT[plant_name=='', plant_name := genus]
DT[, .(plant_name)]
DT[, .N, keyby=plant_name][.N>1]
DT[, .(plant_name)]
DT[, .N, keyby=plant_name][.N>1]
DT[, .N, keyby=plant_name][N>1]
library(data.table)
# load data
DT <- fread('data/plant_categories_v2.csv')
# clean text
clean_text <- function( x){
x <- gsub('\n', ' ', x)         # replace new lines with space
x <- gsub('\\[\\d+\\]', '', x)  # remove references [\\d+]
x <- gsub('\\"+', '\\"', x)     # remove double quotes
x <- gsub('\\s+', ' ', x)       # remove extra whitespace
x <- trimws(x)                  # remove leading and trailing ws
x
}
DT[, description := clean_text(description)]
DT[, story := clean_text(story)]
DT[, uses := clean_text(uses)]
# capatilize all words
capatilize_all <- function(x) {
s <- strsplit(x, " ")[[1]]
paste(toupper(substring(s, 1,1)), substring(s, 2), sep="", collapse=" ")
}
DT[, hawaiian_name := sapply(hawaiian_name, capatilize_all)]
DT[, common_name := sapply(common_name, capatilize_all)]
# capatilize first word
capatilize_first <- function(x) {
paste0(toupper(substr(x,1,1)), substring(x,2))
}
DT[, scientific_name := sapply(scientific_name, capatilize_first)]
DT[, species := sapply(species, capatilize_first)]
DT[, genus := sapply(genus, capatilize_first)]
# reassign plant_name
DT[, species_count := .N, keyby=genus]
DT[, plant_name := ifelse(species_count==1, genus, species)]
DT[, .(plant_name)]
# reorder columns
setcolorder(DT, c(
'plant_name', 'status', 'hawaiian_name', 'common_name', 'scientific_name',
'genus', 'species', 'description', 'story', 'uses'
))
DT
# reorder columns
DT[, species_count := NULL]
setcolorder(DT, c(
'plant_name', 'status', 'hawaiian_name', 'common_name', 'scientific_name',
'genus', 'species', 'description', 'story', 'uses'
))
DT
fwrite(DT, 'data/plant_categories_v3.csv')
plant_meta <- fread('data/plant_categories_v3.csv')
plant_meta
plant_meta[, .(.N, species), by=plant_name][N>1]
dir('data')
dir('data/instagram')
dir('data/instagram/images')
dir('data/instagram/images')
dir('data/instagram/')
dir('data/instagram/', recursive=T)
plant_meta
# instagram
insta_plants <- dir('data/instagram/')
insta_plants
intersect(insta_plants, plant_meta$plant_name)
names(plant_meta)
plant_meta[, .(plant_name, common_name)]
intersect(insta_plants, lower(plant_meta$plant_name))
intersect(insta_plants, tolower(plant_meta$plant_name))
insta_plants <- dir('data/instagram/')
intersect(insta_plants, plant_meta$plant_name)
library(data.table)
library(stringr)
plant_meta <- fread('data/plant_categories_v3.csv')
plant_meta[, .(plant_name, common_name)]
# instagram
insta_plants <- dir('data/instagram/')
rm(list = ls())
library(data.table)
plant_meta <- fread('data/plant_categories_v3.csv')
plant_meta[, .(plant_name, common_name)]
# instagram
insta_plants <- dir('data/instagram/')
intersect(insta_plants, plant_meta$plant_name)
insta_plants
plant_meta
intersect(insta_plants, plant_meta$plant_name)
all(intersect(insta_plants, plant_meta$plant_name) == insta_plants)
file_list <- dir(sprintf('data/instagram/%s', p))
# instagram
for (p in dir('data/instagram/')) {
file_list <- dir(sprintf('data/instagram/%s', p))
break
}
file_list
# instagram
for (p in dir('data/external/instagram/')) {
file_list <- dir(sprintf('data/external/instagram/%s', p))
break
file_list
}
file_list
file_list
file_list <- dir(sprintf('data/external/instagram/%s', p), full.names=T)
file_list
file_list <- dir(sprintf('data/external/instagram/%s', p))
file_list
dir.create(sprintf('data/images/%s', p), showWarnings=F)
# instagram
for (p in dir('data/external/instagram/')) {
file_list <- dir(sprintf('data/external/instagram/%s', p))
dir.create(sprintf('data/images/%s', p), showWarnings=F)
for (f in file_list) {
file.rename(
sprintf('data/external/instagram/%s/%s', p, f),
sprintf('data/images/%s/%s', p, f)
)
}
break
file_list
}
# instagram
for (p in dir('data/external/instagram/')) {
file_list <- dir(sprintf('data/external/instagram/%s', p))
dir.create(sprintf('data/images/%s', p), showWarnings=F)
for (f in file_list) {
file.rename(
sprintf('data/external/instagram/%s/%s', p, f),
sprintf('data/images/%s/%s', p, f)
)
}
}
dir('data/external/google/')
dir('data/external/google/common genus')
# instagram
for (p in dir('data/external/google/common genus', full.names = T, recursive = T)) {
break
}
p
dir_name <- gsub('genus', '', p)
dir_name
dir_name <- gsub('genus|\\s+', '', p)
dir_name
# instagram
for (p in dir('data/external/google/common genus', full.names = T)) {
dir_name <- gsub('genus|\\s+', '', p)
break
}
dir_name
dir(p)
# instagram
for (p in dir('data/external/google/common genus', full.names=T)) {
dir_name <- gsub('genus|\\s+', '', p)
dir.create(dir_name, showWarnings=F)
}
# instagram
for (p in dir('data/external/google/common genus', full.names=T, recursive=T)) {
break
}
p
gsub('genus|\\s+', '', p)
# instagram
for (p in dir('data/external/google/common genus', full.names=T, recursive=T)) {
file.rename(p, gsub('genus|\\s+', '', p))
}
warnings()
# instagram
for (p in dir('data/external/google/common genus', full.names=T)) {
break
file.rename(p, gsub('genus|\\s+', '', p))
}
p
dir.create(gsub('genus|\\s+', '', p))
dir.create(gsub('genus|\\s+', '', p))
# instagram
for (p in dir('data/external/google/common genus', full.names=T)) {
dir.create(gsub('genus|\\s+', '', p))
}
# instagram
for (p in dir('data/external/google/common genus', full.names=T, recursive=T)) {
file.rename(p, gsub('genus|\\s+', '', p))
break
}
# instagram
for (p in dir('data/external/google/common genus', full.names=T, recursive=T)) {
file.rename(p, gsub('genus|\\s+', '', p))
}
plant_meta[, .(plant_name, common_name)]
plant_meta <- fread('data/plant_categories_v3.csv')
plant_meta[, .(plant_name, common_name)]
dir('data/external/oxford')
dir('data/external/oxford/oxford-102-flowers/')
labels <- fread('data/external/oxford/oxford-102-flowers/oxford_102_labels.csv')
labels
labels <- fread('data/external/oxford/oxford-102-flowers/oxford_102_labels.csv')
labels
labels[grepl('hibiscus', labels)]
labels[grepl('hibiscus', plant_name)]
labels <- fread('data/external/oxford/oxford-102-flowers/label_lookup.csv')
labels[grepl('hibiscus', plant_name)]
lookup <- fread('data/external/oxford/oxford-102-flowers/label_lookup.csv')
lookup[grepl('hibiscus', plant_name)]
lookup
dir_name < 'data/external/oxford/oxford-102-flowers'
lookup <- fread(sprintf('%s/label_lookup.csv', dir_name))
dir_name < 'data/external/oxford/oxford-102-flowers'
lookup <- fread(sprintf('%s/label_lookup.csv', dir_name))
dir_name < 'data/external/oxford/oxford-102-flowers'
sprintf('%s/label_lookup.csv', dir_name)
lookup <- fread(sprintf('%s/label_lookup.csv', dir_name))
dir_name
dir_name < 'data/external/oxford/oxford-102-flowers'
dir_name <- 'data/external/oxford/oxford-102-flowers'
lookup <- fread(sprintf('%s/label_lookup.csv', dir_name))
lookup[grepl('hibiscus', plant_name)]
labels <- rbindlist(lapply(
c('train', 'valid', 'test'),
fucntion(x) {data.table(sprintf('%s/%s.txt', x, dir_name))}
))
